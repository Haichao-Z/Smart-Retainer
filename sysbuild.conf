# Sysbuild Configuration for Smart Retainer with Secure FOTA
# Target: nRF7002 DK (nRF5340)
# ========== Network Core Configuration ==========
# Enable network core with HCI IPC for nRF5340
SB_CONFIG_NETCORE_HCI_IPC=y

# ========== MCUboot Bootloader Configuration ==========
# Enable MCUboot bootloader
SB_CONFIG_BOOTLOADER_MCUBOOT=y

# Use dual-slot configuration for FOTA updates
SB_CONFIG_MCUBOOT_MODE_SINGLE_APP=n

# Use all available RAM for MCUboot
SB_CONFIG_MCUBOOT_USE_ALL_AVAILABLE_RAM=y

# ========== Image Signing Configuration ==========
# Path to private key for signing firmware images
# Generate this key using: imgtool.py keygen -k mcuboot_private_key.pem -t ecdsa-p256
SB_CONFIG_BOOT_SIGNATURE_KEY_FILE="${APP_DIR}/private_key.pem"

# Signature type: ECDSA P-256 (Recommended for security and performance)
SB_CONFIG_BOOT_SIGNATURE_TYPE_ECDSA_P256=y

# ========== External Flash Configuration ==========
# Store secondary slot (update image) in external flash
SB_CONFIG_PM_EXTERNAL_FLASH_MCUBOOT_SECONDARY=y
SB_CONFIG_PM_OVERRIDE_EXTERNAL_DRIVER_CHECK=y


SB_CONFIG_SECURE_BOOT_NETCORE=y
SB_CONFIG_MCUBOOT_UPDATEABLE_IMAGES=2
SB_CONFIG_NETCORE_APP_UPDATE=y
SB_CONFIG_MCUBOOT_NRF53_MULTI_IMAGE_UPDATE=y
SB_CONFIG_MCUBOOT_MODE_OVERWRITE_ONLY=y
# ========== Partition Manager ==========
# Enable partition manager
# SB_CONFIG_PARTITION_MANAGER=y
# SB_CONFIG_PARTITION_MANAGER_ENABLED=y

# ========== Build Configuration ==========
# Generate update file (*.bin) for FOTA
# SB_CONFIG_MCUBOOT_GENERATE_CONFIRMED_IMAGE=n